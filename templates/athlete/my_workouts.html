<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>My Workouts - CoachMePlay</title>
<link rel="stylesheet" href="{{ url_for('static', filename='css/style.css') }}">
<link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;700&display=swap" rel="stylesheet">
<style>
        body {
            margin: 0;
            font-family: 'Poppins', sans-serif;
            background: #f0f4f8;
            color: #22223a;
        }
        .dashboard {
            padding: 20px;
            max-width: 1200px;
            margin: 0 auto;
        }
         .navbar {
            background: #2563eb;
            box-shadow: 0 3px 16px rgba(37,99,235,0.12);
            padding: 15px 0;
        }
        .navbar .container {
            display: flex;
            justify-content: space-between;
            align-items: center;
            max-width: 1200px;
            margin: 0 auto;
            padding: 0 24px;
        }
        .navbar-brand {
            color: #fff;
            font-weight: 700;
            font-size: 26px;
            letter-spacing: 1px;
            text-decoration: none;
        }
        .navbar-menu {
            list-style: none;
            display: flex;
            gap: 20px;
            margin: 0;
            padding: 0;
            align-items: center;
        }
        .navbar-menu li a {
            color: #fff;
            font-weight: 600;
            text-decoration: none;
            font-size: 16px;
            padding: 6px 16px;
            border-radius: 6px;
            transition: background 0.16s, color 0.16s;
            display: block;
        }
        .navbar-menu li a:hover {
            background: #10b981;
            color: #fff;
        }
        .notification-wrapper {
            position: relative;
        }
        .notification-bell {
            cursor: pointer;
            font-size: 20px;
            color: #fff;
            position: relative;
            display: inline-block;
        }
        .notification-badge {
            position: absolute;
            top: -6px;
            right: -8px;
            background: #10b981;
            color: #fff;
            font-size: 12px;
            font-weight: 700;
            padding: 2px 6px;
            border-radius: 12px;
        }
        .notification-dropdown {
            display: none;
            position: absolute;
            right: 0;
            top: 30px;
            background: #fff;
            width: 280px;
            border-radius: 8px;
            box-shadow: 0 6px 22px rgba(37,99,235,0.09);
            z-index: 10;
        }
        .notification-header {
            padding: 12px 16px;
            border-bottom: 1px solid #ddd;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        .notification-header h4 {
            margin: 0;
            font-size: 18px;
            color: #10b981;
            font-weight: 700;
        }
        .mark-all-read {
            color: #2563eb;
            font-weight: 600;
            cursor: pointer;
            text-decoration: none;
            font-size: 14px;
        }
        .notification-list {
            max-height: 300px;
            overflow-y: auto;
        }
        .notification-item {
            padding: 12px 16px;
            border-bottom: 1px solid #eee;
            font-size: 14px;
            color: #444;
        }
        .notification-item.empty {
            text-align: center;
            color: #999;
            font-style: italic;
        }
        .dashboard {
            padding: 40px 24px;
            max-width: 1200px;
            margin: 0 auto;
        }
        .welcome {
            text-align: center;
            padding: 80px 20px 60px 20px;
            background: linear-gradient(120deg, #10b981 55%, #2563eb 100%);
            color: #fff;
            box-shadow: 0 8px 35px rgba(16,185,129,0.10);
            border-radius: 16px;
            margin-bottom: 40px;
        }
        .welcome h1 {
            font-size: 48px;
            font-weight: 700;
            margin-bottom: 12px;
            letter-spacing: 1.5px;
        }
        .welcome p {
            font-size: 20px;
            font-weight: 400;
            margin-top: 0;
        }
        .dashboard-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(290px, 1fr));
            gap: 32px;
        }
        .dashboard-card {
            background: #fff;
            padding: 32px 28px 28px 28px;
            border-radius: 16px;
            box-shadow: 0 6px 22px rgba(37,99,235,0.09);
            text-align: center;
            transition: transform 0.18s, box-shadow 0.18s;
            cursor: pointer;
        }
        .dashboard-card:hover {
            transform: translateY(-6px) scale(1.022);
            box-shadow: 0 13px 38px #10b98133;
        }
        .dashboard-card h3 {
            color: #10b981;
            font-size: 24px;
            margin-bottom: 14px;
            font-weight: 700;
        }
        .dashboard-card p {
            font-size: 16px;
            color: #22223a;
            margin-bottom: 20px;
        }
    .page-header {
        background: linear-gradient(120deg, #2563eb 65%, #10b981 100%);
        color: white;
        padding: 44px 38px 32px 38px;
        border-radius: 15px;
        margin-bottom: 38px;
        box-shadow: 0 4px 24px #2563eb24;
        text-align: center;
    }
    .page-header h1 {
        font-size: 2.1rem;
        margin-bottom: 10px;
        font-weight: 700;
        letter-spacing: 1.2px;
    }
    .page-header p {
        opacity: 0.92;
        font-size: 1.09rem;
        margin: 0;
        font-weight: 500;
    }
    .stats-grid {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(285px, 1fr));
        gap: 28px;
        margin-bottom: 44px;
    }
    .stat-card {
        background: linear-gradient(120deg, #10b981 40%, #2563eb 100%);
        color: #fff;
        padding: 30px 10px 28px 24px;
        border-radius: 14px;
        display: flex;
        align-items: center;
        box-shadow: 0 6px 22px rgba(37,99,235,0.09);
        transition: box-shadow 0.2s, transform 0.19s;
        position: relative;
    }
    .stat-card:hover {
        box-shadow: 0 14px 38px #2563eb14;
        transform: translateY(-6px) scale(1.019);
    }
    .stat-icon {
        font-size: 48px;
        margin-right: 18px;
        text-shadow: 0 3px 14px #2563eb33;
    }
    .stat-info h3 {
        margin: 0 0 4px 0;
        font-size: 38px;
        font-weight: bold;
    }
    .stat-info p {
        margin: 0;
        opacity: 0.91;
        font-size: 17px;
    }
    .content-section {
        background: white;
        padding: 38px 34px 38px 34px;
        border-radius: 17px;
        box-shadow: 0 6px 22px rgba(37,99,235,0.09);
        margin-bottom: 0;
    }
    .content-section h2 {
        color: #2563eb;
        margin-top: 0;
        margin-bottom: 26px;
        font-size: 1.55rem;
        font-weight: 700;
    }
    .coaches-grid {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(290px, 1fr));
        gap: 28px;
        margin-top: 4px;
    }
    .coach-card {
        background: #fff;
        border-radius: 15px;
        padding: 30px 24px 27px 24px;
        text-align: left;
        box-shadow: 0 6px 22px rgba(37,99,235,0.09);
        transition: transform 0.20s, box-shadow 0.16s;
        min-height: 220px;
        display: flex;
        flex-direction: column;
        justify-content: space-between;
    }
    .coach-card:hover {
        transform: translateY(-6px) scale(1.018);
        box-shadow: 0 14px 34px #10b98133;
    }
    .coach-card h3 {
        margin: 0 0 14px 0;
        color: #2563eb;
        font-size: 21px;
        font-weight: 700;
    }
    .coach-info p {
        margin: 8px 0;
        color: #545580;
        font-size: 15px;
    }
    .info-label {
        font-weight: 600;
        color: #10b981;
    }
    .coach-actions {
        display: flex;
        gap: 10px;
        margin-top: 18px;
    }
    .coach-actions .btn {
        flex: 1;
        background: linear-gradient(120deg, #10b981 40%, #2563eb 100%);
        color: #fff;
        border: none;
        font-weight: 700;
        font-size: 15px;
        border-radius: 24px;
        padding: 12px 0;
        cursor: pointer;
        box-shadow: 0 2px 10px #10b98112;
        transition: background 0.21s, box-shadow 0.19s, transform 0.15s;
    }
    .coach-actions .btn:hover {
        background: linear-gradient(120deg, #2563eb 60%, #10b981 100%);
        box-shadow: 0 8px 22px #10b98118;
        color: #fff;
        transform: scale(1.04);
    }
    .btn-secondary {
        background: #6c757d;
        color: white;
    }
    .btn-secondary:hover {
        background: #374151;
    }
    .empty-state {
        text-align: center;
        padding: 60px 20px;
        color: #666;
    }
    .empty-state h3 {
        font-size: 23px;
        margin-bottom: 12px;
        color: #22223a;
        font-weight: 700;
    }
    .empty-state p {
        margin-bottom: 18px;
        color: #9ca3af;
        font-size: 15px;
    }
    .empty-state .btn {
        padding: 12px 30px;
        border-radius: 22px;
        background: linear-gradient(120deg, #10b981 40%, #2563eb 100%);
        color: #fff;
        font-weight: 700;
        border: none;
        font-size: 15px;
        cursor: pointer;
    }
    .loading {
        text-align: center;
        padding: 40px;
        color: #999;
        font-size: 16px;
    }
    @media (max-width: 900px) {
        .stats-grid, .coaches-grid { grid-template-columns: 1fr !important; }
        .page-header h1 { font-size: 1.3rem; }
    }
</style>
</head>
<body>
<nav class="navbar">
    <div class="container">
        <a href="/" class="navbar-brand">CoachMePlay</a>
        <ul class="navbar-menu">
            <li><a href="/athlete/dashboard">Dashboard</a></li>
            <li><a href="/athlete/profile">Profile</a></li>
            <li><a href="/athlete/my-workouts" class="active">My Workouts</a></li>
            <li class="notification-wrapper">
                <a href="#" id="notificationBell" class="notification-bell">
                    Notifications
                    <span id="notificationBadge" class="notification-badge">0</span>
                </a>
                <div id="notificationDropdown" class="notification-dropdown">
                    <div class="notification-header">
                        <h4>Notifications</h4>
                        <a href="#" onclick="markAllAsRead(); return false;" class="mark-all-read">Mark all read</a>
                    </div>
                    <div id="notificationList" class="notification-list">
                        <div class="notification-item empty">Loading...</div>
                    </div>
                </div>
            </li>
            <li><a href="#" onclick="logout(); return false;">Logout</a></li>
        </ul>
    </div>
</nav>
<div class="dashboard">
    <div class="page-header">
        <h1>My Workout Plans üí™</h1>
        <p>Training programs assigned by your coach</p>
    </div>
    <div class="stats-grid">
        <div class="stat-card">
            <div class="stat-icon">üìã</div>
            <div class="stat-info">
                <h3 id="totalWorkouts">0</h3>
                <p>Active Plans</p>
            </div>
        </div>
        <div class="stat-card" style="background: linear-gradient(120deg, #4facfe 0%, #00f2fe 100%);">
            <div class="stat-icon">‚úÖ</div>
            <div class="stat-info">
                <h3 id="completedSessions">0</h3>
                <p>Completed Today</p>
            </div>
        </div>
        <div class="stat-card" style="background: linear-gradient(120deg, #f093fb 0%, #f5576c 100%);">
            <div class="stat-icon">üî•</div>
            <div class="stat-info">
                <h3 id="streakDays">0</h3>
                <p>Day Streak</p>
            </div>
        </div>
    </div>
    <div class="content-section">
        <h2>Your Workout Plans</h2>
        <div class="coaches-grid" id="workoutsList">
            <p class="loading">Loading workouts...</p>
        </div>
    </div>
</div>
<script src="{{ url_for('static', filename='js/auth.js') }}"></script>
<script src="{{ url_for('static', filename='js/notifications.js') }}"></script>
<script>
    // Check authentication
    checkAuth();
    // Verify user type
    const userType = localStorage.getItem('user_type');
    if (userType !== 'athlete') {
        alert('Access denied. This page is for athletes only.');
        window.location.href = '/coach/dashboard';
    }
    let athleteId = null;
    async function getAthleteInfo() {
        const token = localStorage.getItem('token');
        try {
            const response = await fetch(`${API_URL}/auth/me`, {
                headers: { 'Authorization': `Bearer ${token}` }
            });
            if (response.ok) {
                const data = await response.json();
                const userId = data.user.user_id;
                const athleteResponse = await fetch(`${API_URL}/athlete/athlete-info/${userId}`, {
                    headers: { 'Authorization': `Bearer ${token}` }
                });
                if (athleteResponse.ok) {
                    const athleteData = await athleteResponse.json();
                    athleteId = athleteData.athlete_id;
                    loadWorkouts();
                }
            }
        } catch (error) {
            console.error('Error fetching athlete info:', error);
        }
    }
    async function loadWorkouts() {
        const token = localStorage.getItem('token');
        try {
            const response = await fetch(`${API_URL}/coach/athlete-workouts/${athleteId}`, {
                headers: { 'Authorization': `Bearer ${token}` }
            });
            if (response.ok) {
                const data = await response.json();
                displayWorkouts(data.plans);
                updateStats(data.plans);
            }
        } catch (error) {
            console.error('Error loading workouts:', error);
        }
    }
    function displayWorkouts(plans) {
        const container = document.getElementById('workoutsList');
        if (plans.length === 0) {
            container.innerHTML = `
                <div class="empty-state">
                    <h3>No Workout Plans Yet</h3>
                    <p>Your coach hasn't assigned any workout plans yet</p>
                    <a href="/athlete/find-coach" class="btn">Find a Coach</a>
                </div>
            `;
            return;
        }
        container.innerHTML = plans.map(plan => `
            <div class="coach-card">
                <h3>${plan.plan_name}</h3>
                <div class="coach-info">
                    <p><span class="info-label">Coach:</span> ${plan.coach_name}</p>
                    <p><span class="info-label">Duration:</span> ${plan.duration_weeks || 'N/A'} weeks</p>
                    <p><span class="info-label">Level:</span> ${plan.difficulty_level || 'N/A'}</p>
                    <p style="color: #666; font-size: 13px; margin-top: 10px;">${plan.description || 'No description'}</p>
                </div>
                <div class="coach-actions">
                    <button onclick="viewWorkoutPlan(${plan.plan_id})" class="btn">
                        üëÅÔ∏è View Workout
                    </button>
                    <button onclick="startWorkout(${plan.plan_id})" class="btn btn-secondary">
                        üèÉ Start Today's Session
                    </button>
                </div>
            </div>
        `).join('');
    }
    function updateStats(plans) {
        document.getElementById('totalWorkouts').textContent = plans.length;
        document.getElementById('completedSessions').textContent = '0';
        document.getElementById('streakDays').textContent = '0';
    }
    function viewWorkoutPlan(planId) {
        window.location.href = `/athlete/workout-plan/${planId}`;
    }
    function startWorkout(planId) {
        localStorage.setItem('currentWorkoutPlan', planId);
        window.location.href = `/athlete/workout-plan/${planId}`;
    }
    getAthleteInfo();
</script>
</body>
</html>
